# 2016101071_황제철_TASK_3

> 컴퓨터 네트워크 프로젝트 관련 정보:
> 
> 1. 팀 : 1조
> 2. 조원 : 박규현(팀장), 김민수, 김종성, 홍지승, 황제철

## 네트워크 계층이란?

---

네트워크 계층은 패킷을 목적지로 라우팅하는 역할을 수행합니다. 네트워크 계층에서 적용되는 주된 프로토콜은 `Internet Protocol(IP)` 입니다. 인터넷 프로토콜은 `IPv4`, `IPv6` 가 대표적이며, `ICMP`, `IGMP`, `ARP` 등의 여러 프로토콜을 수행하고 있습니다.

## 프로토콜 별 패킷 분석

---

### IPv4 (Internet Protocol version 4)

IPv4는 현재까지도 가장 대중적으로 사용되는 인터넷 프로토콜입니다. 인터넷 상에서 컴퓨터 간 또는 네트워크 장치 간 통신을 위해 사용되며, 32비트 주소 체계를 사용하여 각 컴퓨터 또는 네트워크 장치를 식별합니다.

아래 패킷은 지난 번 과제에서 lms 접속시 캡쳐된 패킷 중의 한 TCP 패킷을 확인한 것입니다.

위 패킷을 분석하기 위해 강의안에 있는 datagram format을 먼저 확인하고 패킷을 보겠습니다.

![Untitled](2016101071_%E1%84%92%E1%85%AA%E1%86%BC%E1%84%8C%E1%85%A6%E1%84%8E%E1%85%A5%E1%86%AF_TASK_3%2001a3f7446c404eadac18e6d6ad1b4481/Untitled.png)

아래 패킷의 IPv4 헤더를 하나하나 분석해보겠습니다.

![Untitled](2016101071_%E1%84%92%E1%85%AA%E1%86%BC%E1%84%8C%E1%85%A6%E1%84%8E%E1%85%A5%E1%86%AF_TASK_3%2001a3f7446c404eadac18e6d6ad1b4481/Untitled%201.png)

`version`은 인터넷 프로토콜의 버전을 나타내며, 0100이므로 IPv4임을 알려주고 있습니다.

`header length`는 IP 헤더의 크기를 나타내며, 0101이므로 기본값인 20Byte로 구성됨을 알 수 있습니다.  

`differentiated services field`는 패킷의 우선순위를 나타내며, 패킷의 서비스 품질을 지정하는 데 사용됩니다.

`flags`는 3비트로 구성되며 패킷의 분할 상태를 나타내는 필드입니다. 이는 아래와 같은 내용들로 이루어집니다.

- `don't fragment` 는 패킷의 분할 가능 여부을 나타냅니다. 위 패킷에서는 1이므로 분할을 할 수 없음을 나타내고 있습니다. 만약 0이라면 분할이 가능합니다.
- `more fragments` 는 분할된 패킷이 더 있는지를 나타냅니다. 위 패킷에서는 0이므로 추가 조각이 없음을 나타내고 있습니다. 만약 1이라면 라우터는 더 많은 분할 패킷에 대한 확인 및 처리를 수행해야 합니다.

`fragment offset`은 분할된 패킷 시리즈에서 현재 분할 패킷의 위치를 나타내고 있습니다. 위 패킷에서는 분할을 허용하지 않고 있으므로 offset 또한 0임을 알 수 있습니다. 만약 값이 있을 때에는 분할 패킷을 재조립할 때 이 값을 이용하여 순서를 맞추게 됩니다.

`time to live`은 네트워크에서의 패킷 수명을 나타냅니다. 라우터를 통과할 때마다 1씩 감소하며, 0이 되면 패킷은 폐기됩니다. 이로 인해 패킷이 네트워크 상에서 유랑하는 것을 방지합니다. 위 패킷에서는 128이라는 값을 가지고 있습니다.

`protocol`은 상위 계층의 프로토콜을 알려주고 있습니다. 이 패킷은 TCP패킷을 캡쳐한 것이었으므로 위 분석 값에서도 상위 프로토콜이 TCP임을 보여주고 있습니다.

`header checksum`은 헤더의 무결성을 체크하기 위한 값입니다. 옆에 나와있는 validation disabled는 와이어샤크가 체크섬 값 계산을 기본적으로 성능상 꺼두었기 때문에 보여지는 것으로, 패킷 데이터와는 상관이 없는 정보입니다. 이에 따라 checksum을 확인하지 않았기 때문에 그 아래에서도 unverified라고 확인되는 것을 볼 수 있습니다.

`source address`은 패킷의 출발지 IP 주소를 나타냅니다. 이는 32비트의 IPv4로 구성된 주소임을 볼 수 있습니다.

`destination address`는 패킷의 목적지 IP주소를 나타냅니다. 이 또한 32비트의 IPv4로 구성된 주소임을 볼 수 있습니다.

### ARP (Address Resolution Protocol)

ARP 프로토콜은 MAC 주소를 결정하기 위해, 네트워크에서 IP 주소를 물리적인 MAC 주소로 매핑하는 데 사용되는 프로토콜입니다. 이를 통해 장치 간 통신을 돕습니다. 

다음은 LMS 접속 시의 캡처된 ARP 패킷에 대한 헤더 필드 분석 내용입니다.

![Untitled](2016101071_%E1%84%92%E1%85%AA%E1%86%BC%E1%84%8C%E1%85%A6%E1%84%8E%E1%85%A5%E1%86%AF_TASK_3%2001a3f7446c404eadac18e6d6ad1b4481/Untitled%202.png)

`hardware type`은 네트워크 하드웨어의 종류를 식별합니다. 위 필드가 1이라고 나와 있는 것으로 보아 Ethernet을 나타냄을 확인할 수 있습니다.

`protocol type`은 상위 프로토콜의 종류를 식별합니다. 일반적으로 IPv4를 사용하며, 이는 0x0800으로 표기합니다.

`hardware size`는 MAC address의 길이를 나타내며, 위 데이터에서 6은 6Byte를 의미합니다. 이더넷의 경우 6Byte로 구성됩니다.

`protocol size`는 Protocol address의 길이를 나타내며, 위 데이터에서 4는 4Byte를 의미합니다. IPv4의 경우 4Byte로 구성됩니다.

`opcode`는 ARP의 작업을 나타내며, 0부터 8까지 존재합니다. 일반적으로 1아니면 2로 이루어지며, 위에서 확인되는 1은 request로, ARP 요청을 나타냅니다. 2는 reply로, ARP 응답을 나타냅니다. 대개 ARP request는 목적지의 MAC주소를 알지 못할 때 전송되며, ARP reply는 MAC주소를 알고 있을 때 전송됩니다. 위 패킷에서는 브로드캐스트를 통해 MAC address를 요청하는 패킷임을 알 수 있습니다.

`sender MAC address`는 ARP 패킷을 보내는 MAC 주소를 나타냅니다.

`sender IP address`는 ARP 패킷을 보내는 IP 주소를 나타냅니다.

`target MAC address`는 ARP 패킷을 받는 장치의 MAC주소를 나타냅니다. 위 패킷에서는 request 패킷이기 때문에 타겟 MAC 주소를 알지 못해 0으로 설정된 것을 알 수 있습니다.

`target IP address`는 ARP 패킷을 받는 장치의 IP 주소를 나타냅니다.

![Untitled](2016101071_%E1%84%92%E1%85%AA%E1%86%BC%E1%84%8C%E1%85%A6%E1%84%8E%E1%85%A5%E1%86%AF_TASK_3%2001a3f7446c404eadac18e6d6ad1b4481/Untitled%203.png)

참고하면, 위 패킷은 `opcode`가 reply(2)이므로 `target MAC address`가 존재하는 것을 알 수 있습니다.

### IPv6 (Internet Protocol version 6)

IPv6는 IP주소 고갈 문제를 해결하기 위해 등장한 IPv4의 대안입니다. 오늘날 IPv6로의 전환이 진행되고 있습니다.

![Untitled](2016101071_%E1%84%92%E1%85%AA%E1%86%BC%E1%84%8C%E1%85%A6%E1%84%8E%E1%85%A5%E1%86%AF_TASK_3%2001a3f7446c404eadac18e6d6ad1b4481/Untitled%204.png)

`version`은 IP 프로토콜의 버전을 나타내며, 0110이므로 버전6임을 알 수 있습니다.

`traffic class`는 패킷의 우선순위를 나타내며, IPv4의 `differentiated services field`와 유사함을 알아볼 수 있습니다.

`flow label`은 패킷이 특정 플로우를 갖는 경우, 이를 식별하기 위해 사용됩니다.  위 패킷의 경우 0x000000으로 나타나 있어 flow label 필드가 비어있는 것임을 알 수 있습니다. 이는 해당 패킷이 특정한 플로우를 식별하지 않으므로, 일반적인 처리 방식으로 다뤄질 것임을 알 수 있습니다.

`payload length`는 IPv6헤더 다음에 올 데이터(페이로드)의 크기를 나타냅니다. 

`next header`는 다음에 오는 헤더의 타입을 알려줍니다. 해당 패킷의 경우 ICMPv6패킷을 분석한 거라서 이어지는 헤더가 ICMPv6임을 알 수 있습니다.

`hop limit`은 패킷이 네트워크를 통과할 때 거쳐갈 수 있는 라우터의 최대 수를 나타냅니다. 하나씩 거쳐가는 것을 hop이라고 하기 때문에 hop limit이라고 명명되어 있습니다. 만약 해당 리미트를 초과할 경우 패킷의 네트워크 내 유랑을 방지하기 위해 해당 패킷은 폐기됩니다.

`source address`는 패킷을 보낸 송신자의 IPv6주소를 나타냅니다.

`destination address`는 패킷을 받는 수신자의 IPv6주소를 나타냅니다.

### ICMPv6 (Internet Control Message Protocol version 6)

ICMP는 네트워크 계층의 대표적인 프로토콜 중 하나로, 네트워크에서 발생하는 제어 메시지를 전달하기 위해 사용되는 프로토콜입니다.

ICMP는 기본적으로 IPv4에서 사용되는데, ICMPv6는 IPv6에서 사용됩니다. 따라서 당연히 주소 체계도 각각의 인터넷 프로토콜에 맞게 사용되며, 패킷 또한 ICMPv6는 IPv6 패킷의 헤더 부분에 위치합니다. 반면 ICMPv4는 IP패킷의 데이터 부분에 포함됩니다. 또한 ICMPv6가 수행할 수 있는 기능이 ICMPv4에 비해 조금 더 많습니다.

![Untitled](2016101071_%E1%84%92%E1%85%AA%E1%86%BC%E1%84%8C%E1%85%A6%E1%84%8E%E1%85%A5%E1%86%AF_TASK_3%2001a3f7446c404eadac18e6d6ad1b4481/Untitled%205.png)

`Type`은 ICMP의 메세지 유형을 나타내는 필드입니다. 위 패킷의 경우 136이라는 필드값을 보여주고 있으며, 이는 “이웃 공지”라는 메시지 유형을 나타내고 있습니다. 이웃 장치가 네트워크에 존재함을 알리기 위해 사용됩니다. 이러한 이웃 공지는 Option 필드를 통해 이웃의 링크 계층 주소(MAC 주소)를 같이 담아 전달합니다. 위 패킷 중 Option 필드에서 해당 내용을 담고 있습니다. 이 정보를 통해 수신 장치가 해당 이웃의 MAC 주소를 알 수 있도록 합니다.

`Code`는 Type필드에서 식별된 메시지에 대한 추가 정보를 제공하며, 이는 Type값에 따라 달라집니다. 위 패킷은 이웃 공지 메시지이며, Code가 0이므로 “정상적인 이웃 공지 메세지”임을 나타내고 있습니다.

`Checksum`은 계산을 통해 ICMP 헤더의 손상 여부를 판단하기 위해 사용되는 값을 담는 필드입니다. 계산 결과가 0이면 손상이 없는 것으로 판단하며, 그 외의 값인 경우 손상이 있음으로 인식하게 됩니다. 위 패킷에서는 정상적인 상태를 나타냄을 알 수 있습니다.

`Flags`는 다음과 같은 내용으로 구성됩니다.

- Solicited : 이는 이웃 공지 메세지가 이웃 요청 메세지에 대한 응답인지를 나타냅니다. 위 패킷에서는 0으로 확인되므로 요청에 대한 응답이 아님을 알 수 있습니다.
- Override : 이는 이웃 공지 메세지에 포함된 링크 계층 주소의 수정 필요성을 나타냅니다. 위에서는 1로 확인되므로 수정을 해야 함을 표현하고 있습니다.

`Target Address`는 패킷을 받는 장치의 MAC주소를 나타냅니다.